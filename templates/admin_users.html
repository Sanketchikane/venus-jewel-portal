{% extends "admin_dashboard.html" %}
{% block content %}
<style>
  body {
    background: url("/static/images/dimension.jpg") no-repeat center center fixed;
    background-size: cover;
  }
  .user-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 16px;
    padding: 40px 30px;
    box-shadow: 0 6px 24px rgba(0, 0, 0, 0.12);
    max-width: 1150px;
    margin: 40px auto;
    font-family: 'Segoe UI', sans-serif;
    backdrop-filter: blur(10px);
  }
  h2 {
    font-size: 26px;
    color: #004080;
    text-align: center;
    margin-bottom: 20px;
  }
  .pending-title { font-size: 22px; color: #0066cc; margin: 30px 0 10px; text-align: center; }
  .user-table { width: 100%; border-collapse: collapse; font-size: 15px; }
  .user-table thead { background: linear-gradient(to right, #004080, #0073e6); color: white; }
  .user-table th, .user-table td { padding: 12px 14px; border-bottom: 1px solid #ddd; text-align: left; }
  .user-table tbody tr:hover { background-color: #f0f7ff; }
  form.inline-form input { padding: 6px 8px; margin: 2px; border-radius: 4px; border: 1px solid #ccc; }
  form.inline-form button { padding: 6px 10px; background: #004080; color: white; border: none; border-radius: 4px; cursor: pointer; }
  form.inline-form button:hover { background: #002c5a; }
</style>

<div class="user-card">
  <h2>ðŸ‘¥ Approved Users â€“ Venus File Portal</h2>

  {% if users %}
  <table class="user-table">
    <thead>
      <tr>
        {% for key in users[0].keys() %}
        <th>{{ key }}</th>
        {% endfor %}
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
      <tr>
        {% for key, value in user.items() %}
        <td>{{ value }}</td>
        {% endfor %}
        <td>
          <a href="{{ url_for('view_user', username=user['Username']) }}" class="action-link">View</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p style="text-align:center;color:#004080;font-weight:600;">No approved users found.</p>
  {% endif %}

  <h3 class="pending-title">ðŸ•’ Pending Registration Requests</h3>
  <table class="user-table" id="pending-table">
    <thead>
      <tr>
        <th>Full Name</th>
        <th>Email</th>
        <th>Contact</th>
        <th>Organization</th>
        <th>Status</th>
        <th>Approve</th>
      </tr>
    </thead>
    <tbody id="pending-body">
      <tr><td colspan="6" style="text-align:center;">Loading...</td></tr>
    </tbody>
  </table>
</div>

<script>
  async function loadPending() {
    try {
      const res = await fetch("/api/pending-registrations");
      const data = await res.json();
      const tbody = document.getElementById("pending-body");
      tbody.innerHTML = "";
      if (!data.pending || data.pending.length === 0) {
        tbody.innerHTML = "<tr><td colspan='6' style='text-align:center;'>No pending requests.</td></tr>";
        return;
      }
      data.pending.forEach(r => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${r["Full Name"] || ""}</td>
          <td>${r["Email"] || ""}</td>
          <td>${r["Contact Number"] || ""}</td>
          <td>${r["Organization"] || ""}</td>
          <td>${r["Status"] || "Pending"}</td>
          <td>
            <form class="inline-form" method="POST" action="/admin/create-credential">
              <input type="hidden" name="email" value="${r["Email"]}">
              <input type="text" name="username" placeholder="Username" required>
              <input type="text" name="password" placeholder="Password" required>
              <button type="submit">Approve</button>
            </form>
          </td>`;
        tbody.appendChild(tr);
      });
    } catch (e) {
      document.getElementById("pending-body").innerHTML =
        "<tr><td colspan='6' style='text-align:center;color:red;'>Error loading pending requests.</td></tr>";
    }
  }
  loadPending();
</script>
{% endblock %}
