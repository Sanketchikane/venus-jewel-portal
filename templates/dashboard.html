<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Venus Jewel File Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ✅ Favicon Setup -->
  <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='images/apple-touch-icon.png') }}">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='images/favicon-32x32.png') }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='images/favicon-16x16.png') }}">
  <link rel="manifest" href="{{ url_for('static', filename='images/site.webmanifest') }}">
  <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='static.css') }}">
</head>
<body>

<div class="sidebar">
  <div class="logo">
    <img src="{{ url_for('static', filename='images/vj_logo_new.png') }}" alt="Venus Jewel Logo">
    <h2>Dashboard</h2>
  </div>
  <ul class="nav-links">
    <li><a href="#"><i class="fas fa-user"></i> {{ user }}</a></li>
    <li><a href="#" onclick="showPasswordModal()"><i class="fas fa-lock"></i> Change Password</a></li>
    <li><a href="https://drive.google.com/drive/u/0/folders/1Yjvp5TMg7mERWxq4dsYJq748CcQIucLK" target="_blank"><i class="fas fa-folder"></i> Uploaded Files</a></li>
    <li><a href="/logout"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
  </ul>
</div>

<div class="main-content">
  <h2>Venus Jewel File Portal</h2>
  <form id="uploadForm">
    <label for="packetNo">Packet Number</label>
    <input type="text" id="packetNo" name="packetNo" placeholder="Enter Packet Number" required>
    <div id="subpoints"></div>
    <button type="submit" class="upload-btn">Upload & Proceed</button>
  </form>

  <div id="spinner">
    <div class="loader"></div>
    <div>Please wait, uploading...</div>
  </div>
  <div class="status" id="statusMsg"></div>
</div>

<div id="passwordModal">
  <div class="modal-content">
    <h3>Change Password</h3>
    <a href="/forgot-password">Change Password</a><br>
    <button onclick="closePasswordModal()">OK</button>
  </div>
</div>

<script>
  const SUBPOINTS = [
    "Front Hand", "Back Hand", "Tweezer", "Shade Card",
    "Face Up Shade Card", "Profile", "In Dabbi", "Daylight"
  ];
  const subpointContainer = document.getElementById('subpoints');
  SUBPOINTS.forEach(point => {
    const label = document.createElement('label');
    label.textContent = point;
    const input = document.createElement('input');
    input.type = 'file';
    input.name = 'file_' + point;
    subpointContainer.appendChild(label);
    subpointContainer.appendChild(input);
  });

  document.getElementById("uploadForm").addEventListener("submit", function(e) {
    e.preventDefault();
    const form = document.getElementById("uploadForm");
    const formData = new FormData(form);
    document.getElementById("spinner").style.display = "block";
    document.getElementById("statusMsg").textContent = "";

    fetch("/upload", {
      method: "POST",
      body: formData
    })
    .then(res => res.json())
    .then(data => {
      document.getElementById("spinner").style.display = "none";
      document.getElementById("statusMsg").textContent = data.success ? "✅ Files uploaded successfully." : "❌ " + data.message;
    })
    .catch(() => {
      document.getElementById("spinner").style.display = "none";
      document.getElementById("statusMsg").textContent = "❌ Upload error occurred.";
    });
  });

  function showPasswordModal() {
    document.getElementById("passwordModal").style.display = "flex";
  }

  function closePasswordModal() {
    document.getElementById("passwordModal").style.display = "none";
  }
</script>

</body>
</html>
